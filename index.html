<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV Address Formatter</title>
    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV Address Formatter</title>
    <style>
    body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 0;
        background: url('URL_OF_YOUR_MECHANICAL_BACKGROUND_IMAGE') no-repeat center center fixed;
        background-size: cover;
        color: white;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .container {
        background: rgba(0, 0, 0, 0.75);
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        width: 40%;
        min-width: 300px;
    }
    h1 {
        text-align: center;
        color: #fff;
        margin-bottom: 20px;
        font-weight: 300;
    }
    .styled-button {
        display: block;
        width: calc(100% - 20px);
        padding: 10px;
        margin-top: 20px;
        background: linear-gradient(45deg, #9c27b0, #ff9800);
        border: none;
        border-radius: 5px;
        color: white;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
        outline: none;
        text-align: center;
    }
    .styled-button:hover, .styled-button:focus {
        background: linear-gradient(45deg, #ff9800, #9c27b0);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    }
    /* Hidden input file styling */
    .input-file-container {
        position: relative;
        width: calc(100% - 20px);
    }
    .input-file-trigger {
        display: block;
        padding: 10px;
        border-radius: 5px;
        text-align: center;
        background: linear-gradient(45deg, #9c27b0, #ff9800);
        color: white;
        font-size: 16px;
        transition: all 0.3s ease;
        cursor: pointer;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
        width: 100%;
    }
    .input-file {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
    }
    .input-file-trigger:hover, .input-file-trigger:focus {
        background: linear-gradient(45deg, #ff9800, #9c27b0);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    }
</style>
</head>
<body>
    <div class="container">
    <h1>CSV Address Formatter</h1>
    <div class="input-file-container">
        <label class="input-file-trigger" for="csvFile">Select CSV File</label>
        <input type="file" id="csvFile" class="input-file" accept=".csv">
    </div>
    <button id="processBtn" class="styled-button">Process CSV</button>
</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        document.getElementById('processBtn').addEventListener('click', function() {
            var fileInput = document.getElementById('csvFile');
            var file = fileInput.files[0];

            if (file) {
                Papa.parse(file, {
                    complete: function(results) {
                        var data = results.data;
                        var correctedData = correctAddresses(data);
                        downloadCorrectedCSV(correctedData);
                    }
                });
            } else {
                alert('Please select a CSV file to process.');
            }
        });

       function correctAddresses(rows) {
    // The first row is assumed to be blank or not needed since we are constructing a new header row
    let correctedData = [];

    // Define new headers for the corrected CSV
    let headers = ['Directory Link', 'Business Name', 'Category 1', 'Sub category 1', 'About', 'Address', 'Address line 2', 'City', 'State', 'Zip', 'Phone', 'Country', 'Email', 'Website', 'Instagram username', 'Facebook username', 'Twitter username', 'YouTube video link'];
    correctedData.push(headers);

    // Start processing from the first row since there are no headers
    rows.forEach((row, index) => {
        if (index === 0) return; // Skip the first row if it's blank or not needed

        // Initialize an array to hold corrected row data
        let correctedRow = new Array(headers.length).fill('');

        // Process the full address from the assumed column index for 'M'
        let fullAddress = row[12]; // Column M is at index 12
        let addressComponents = fullAddress ? fullAddress.split(',') : [];

        // Extract street address (Column F), which is typically the first component
        correctedRow[5] = addressComponents[0] || ''; // Address

        // Check for suite or office number and city (Column G and H)
        if (addressComponents.length > 1) {
            let suiteOrOfficeMatch = addressComponents[1].match(/(suite|office) \d+/i);
            correctedRow[6] = suiteOrOfficeMatch ? suiteOrOfficeMatch[0] : ''; // Address line 2
            correctedRow[7] = suiteOrOfficeMatch ? addressComponents[2] || '' : addressComponents[1] || ''; // City
        }

        // State and Zip (Column I and J)
        if (addressComponents.length > 2) {
            correctedRow[8] = addressComponents[addressComponents.length - 2] || ''; // State
            correctedRow[9] = addressComponents[addressComponents.length - 1] || ''; // Zip
        }

        // Populate other data from the assumed columns
        correctedRow[0] = row[3] || ''; // Directory Link from Column D
        correctedRow[1] = row[7] || ''; // Business Name from Column H
        correctedRow[2] = 'Shop Local'; // Category 1
        correctedRow[3] = 'Essential Business'; // Sub category 1
        correctedRow[4] = row[11] || ''; // About from Column L
        correctedRow[10] = (row[6] || '').replace(/\D/g, ''); // Phone from Column G, remove non-digits
        correctedRow[11] = 'US'; // Country
        correctedRow[12] = row[9] || ''; // Email from Column J

        // Add corrected row to the data array
        correctedData.push(correctedRow);
    });

    return correctedData;
}
        function downloadCorrectedCSV(data) {
            var csv = Papa.unparse(data);
            var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement('a');
            var url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'corrected_addresses.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
