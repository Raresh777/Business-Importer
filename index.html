<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV Address Formatter</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2, #6e45e2, #88d3ce);
            color: white;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }
        h1 {
            text-align: center;
            color: #fff;
        }
        input[type="file"] {
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            background: linear-gradient(to right, #6e45e2, #88d3ce);
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
        }
        button:hover {
            background: linear-gradient(to right, #88d3ce, #6e45e2);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CSV Address Formatter</h1>
        <input type="file" id="csvFile" accept=".csv">
        <button id="processBtn">Process CSV</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        document.getElementById('processBtn').addEventListener('click', function() {
            var fileInput = document.getElementById('csvFile');
            var file = fileInput.files[0];

            if (file) {
                Papa.parse(file, {
                    complete: function(results) {
                        var data = results.data;
                        var correctedData = correctAddresses(data);
                        downloadCorrectedCSV(correctedData);
                    }
                });
            } else {
                alert('Please select a CSV file to process.');
            }
        });

        function correctAddresses(data) {
    return data.map((row, index) => {
        if (index === 0) {
            // Headers for the corrected CSV
            return ['Directory Link', 'Business Name', 'Category 1', 'Sub category 1', 'About', 'Address', 'Address line 2', 'City', 'State', 'Zip', 'Phone', 'Country', 'Email', 'Website', 'Instagram username', 'Facebook username', 'Twitter username', 'YouTube video link'];
        }

        // Extracting and formatting data from the original CSV
        const directoryLink = row[3]; // Column D
        const businessName = row[7]; // Column H
        const about = row[11]; // Column L
        const fullAddress = row[12]; // Column M
        let [address, addressLine2, city, state, zip] = ['', '', '', '', ''];

        if (fullAddress) {
            let parts = fullAddress.split(',');
            address = parts[0].trim();
            city = (parts.length > 2) ? parts[1].trim() : '';
            state = (parts.length > 2) ? parts[parts.length - 2].trim() : '';
            zip = (parts.length > 2) ? parts[parts.length - 1].trim() : '';
            addressLine2 = (parts.length > 3) ? parts[1].trim() : '';
        }

        let phone = row[6].replace(/[\s-]/g, ''); // Column G
        const email = row[9]; // Column J

        // Setting static values for some columns
        const category1 = 'Shop Local';
        const subCategory1 = 'Essential Business';
        const country = 'US';
        const website = '';
        const instagram = '';
        const facebook = '';
        const twitter = '';
        const youtube = '';

        return [directoryLink, businessName, category1, subCategory1, about, address, addressLine2, city, state, zip, phone, country, email, website, instagram, facebook, twitter, youtube];
    });
}
        function downloadCorrectedCSV(data) {
            var csv = Papa.unparse(data);
            var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement('a');
            var url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'corrected_addresses.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
